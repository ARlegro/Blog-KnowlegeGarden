---
{"dg-publish":true,"permalink":"/Computer_Science/C언어, 자료구조, 알고리즘/키워드공부/동적 메모리/","noteIcon":"","created":"2025-08-07T17:48:39.259+09:00","updated":"2025-08-18T01:06:58.988+09:00"}
---




### 동적 메모리 할당이란❓
> 프로그램 **실행 도중에 메모리를 할당 받는** 것 
- **프로그램의 메모리 할당과 반환**
	- 프로그램은 필요한 만큼의 메모리를 OS로부터 할당받아서 사용
	- 사용이 끝나면 OS에 메모리를 반납 
	  
- **동적 메모리 할당기법** 
	- 필요한 만큼만 메모리를 할당하고 반환하여 **메모리를 효율적으로 사용**하게 하는 것  
	- C에서는 `malloc()` 계열의 라이브러리 함수를 사용하여 할당 받아 사용 가능 


### C언어의 동적 메모리 할당과 해제 
> 필요한 만큼 메모리 공간을 힙(Heap) 영역에 직접 할당 받는 기술 

>[!tip] 필요 라이브러리 
>`<stdib.h>` 헤더 파일에 정의된 `malloc()`함수를 사용하여 수행 
```c
#include <stdlib.h> // malloc(), free() 사용을 위한 
```

#### 할당(Allocation) - malloc 
#malloc 

✔`malloc(size)`함수 
- 역할 : 인자로 전달된 size byte만큼의 **메모리를 힙 영역에 할당** 
- **기본 반환 값** : `void *`타입 ⬅ 어떤 타입의 데이터라도 담을 수 있는 주소
- **🥊메모리 할당 실패 시** : `Null` 반환 (So null 체크 자주 ㄱ)


**✅예시** 
```c
int main(){
	int *pi = (int *) malloc(sizeof(int)); // int 하나만큼 메모리 할당
  if (pi == NULL){ // Null 체크 
    printf("메모리 할당 못한거\n");
    return 1;
  }

  *pi = 14; // 할당된 메모리에 값 저장
	  return 0;
}
```
`(int *)malloc(sizeof(int));`
- **전체 의미**
	- int를 하나 저장할 수 있는 힙 메모리를 만들고 그 주소를 int 포인터로 반환하라는 뜻
- `malloc(x)`
	- memory allocation 
	- **x 크기만큼의 메모리를 힙 영역에 할당**하는 것 
	- `sizeof(int)` = `int`타입 하나가 차지하는 바이트 수(4byte)
- `(int *)` : void 포인터를 int 포인터롤 형 변환 

>[!tip] void* 의 자동 형 변환
>- C에서 `void *`를 다른 포인터 타입으로 대입 시 명시적 형변환이 없어도 **자동 변환이 된다.** by 컴파일러 (🥊C++은 안됨)


>[!tip] sizeof()를 사용하여 인자에 크기를 전달하는 이유 
>- **이식성 확보**가 가장 크다
>- OS마다 CPU 아키텍쳐마다 자료형의 크기가 다를 수 있다.
>- `sizeof()`는 자동으로 크기를 계산해주므로 문제를 사전에 방지 가능 


#### 해제(Deallocation)
#free
> 동적으로 할당된 메모리는 **사용 후 반드시 명시적 해제 필요** 

>[!QUESTION] 해제 안하면❓
메모리가 프로그램 종료할 때까지 반환되지 않는 **"메모리 누수"** 발생 

✔`free(포인터)` 함수 
- `malloc`, `calloc`, `realloc`으로 **할당받은 메모리를 OS에 반환**한다
- param : **메모리 할당 함수가 반환했던 포인터**를 인자로 받는다 

>[!tip] 메모리 해제 후 - Null로 초기화 必
>- p라는 포인터의 메모리 할당을 해제한다해도 **p는 여전히 그 메모리를 가리키고** 있다 ➡ 추후 접근 시 **오류 발생 💢**
>- 만약, 


```c
int main(void){
  int *pi = (int *)malloc(sizeof(int));
  if (pi == NULL){
    printf("메모리 할당 못한거\n");
    return 1;
  }

  *pi = 14; // 할당된 메모리에 값 저장
  printf("할당된 메모리 주소: %p, 값: %d\n", pi, *pi);


	// 메모리 해제 - 힙 메모리 해제
  free(pi);
  printf("메모리 해제 완\n");

	// 오류 방지
  pi = NULL; 
  return 0;
}
// 출력 값 
//할당된 메모리 주소: 0x560cbacff2a0, 값: 14
//메모리 해제 완
```



### 심화 : 포인터를 배열처럼 

> 포인터를 배열처럼 활용할 수도 있다.

```c
#include<stdio.h>
#include<stdlib.h>

int main(void) {
  // 동적 메모리를 배열처럼 사용하는 경우
  char *p_name = malloc(3);

  p_name[0] = 'a';
  p_name[1] = 'b';
  p_name[2] = 'c';
  printf("%s\n", p_name); // abc
  
  free(p_name);

  // 일반적 배열 사용
  char name[3];
  name[0] = 'a';
  name[1] = 'b';
  name[2] = 'c';
  printf("%s\n", name); // abc
  return 0;
}
```
![Pasted image 20250807215517.png](/img/user/supporter/image/Pasted%20image%2020250807215517.png)

>[!QUESTION] 그렇다면 배열 방법과 무슨 차이일까?
> - 사실, 배열은 포인터 상수이다(즉, 배열은 포인터였던 것...)
> - 우리가 쓰는 포인터는 변수   
> - **⭐포인터 변수(`*`)는 주소값을 바꿀 수 있다!!!**



### 다른 동적 메모리 할당 함수 

> `malloc()`외에도 `calloc()`, `realloc()`라는 함수도 모두 Heap 영역에 메모리를 할당하는 함수들이다.

#### 1. calloc() - Contiguous Allocation 
> 자료형의 개수만큼 메모리를 할당 
> - `calloc(요소의 개수, 요소의크기);`

**예시 - `calloc(3, sizeof(int));`**
- int형 3개를 담을 수 있는 **메모리 공간을 할당**하고, **모든 값을 0으로 초기화**

`malloc()`은 할당된 메모리 공간을 초기화하지 않는다. 따라서, 할당 받은 메모리에 이전에 쓰던 잔재가 있으면 그거를 재사용 할 수도 있음 




#### 2. realloc() - Re-Allocation 
> 이미 할당된 **메모리 크기를 변경** 
- 기존 데이터는 유지하면서 메모리 크기 조정하고 싶을 때 사용 
- 문법 : `realloc(기존포인터, 새로운메모리크기)`
