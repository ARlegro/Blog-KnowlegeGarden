---
{"dg-publish":true,"permalink":"/Computer_Science/Network/C-Network/Concurrent Proxy κµ¬ν„/","noteIcon":"","created":"2025-12-03T14:52:46.116+09:00","updated":"2025-12-13T18:25:26.794+09:00"}
---

μ°Έκ³ 
- [[Computer_Science/Network/C-Network/κΈ°λ³Έ Proxy κµ¬ν„ν•΄λ³΄κΈ°\|κΈ°λ³Έ Proxy κµ¬ν„ν•΄λ³΄κΈ°]]
- κΉƒν—λΈ λ§ν¬ : https://github.com/ARlegro/web-server-impl 


κΈ°μ΅΄ κΈ°λ³Έ Proxy μ½”λ“([[Computer_Science/Network/C-Network/κΈ°λ³Έ Proxy κµ¬ν„ν•΄λ³΄κΈ°\|κΈ°λ³Έ Proxy κµ¬ν„ν•΄λ³΄κΈ°]])λ¥Ό λ™μ‹μ„± ν”„λ΅κ·Έλλ°μΌλ΅ λ§λ“λ” κ³Όμ •

> λ©€ν‹° μ¤λ λ“ κΈ°λ°μ΄κ³ , λ³€κ²½ν• κ² λ§μ΄ μ—†λ‹¤.

### fd ν• λ‹Ή - mallocμΌλ΅ λ³€κ²½

```c
	int *connfdp;
	
	while (1) {
			...
			connfdp = Malloc(sizeof(int));
			*connfdp = Accept(listenfd, ~~~~)
			Pthread_create(&tid, NULL, thread, connfdp);
	}
```
νλ¦„ κ°„λ‹¨ μ„¤λ… 
- main μ“°λ λ“κ°€ `while`λ¬Έμ„ λλ©΄μ„ κ³„μ† μƒλ΅μ΄ ν΄λΌμ΄μ–ΈνΈμ μ—°κ²°μ„ λ°›λ”λ‹¤.
- μ΄λ• `Accept()`κ°€ λ°ν™ν•λ” fdλ¥Ό κ° μ“°λ λ“μ—κ² λ°ν™ν•΄μ•Ό ν•¨ 

>[!tip] Malloc μ‚¬μ© μ΄μ  - κ²½μ μ΅°κ±΄ ν•΄κ²°
>- π’Άλ¬Έμ  : μ¤νƒμ— μ €μ¥λ μ§€μ—­ λ³€μ μ‚¬μ© μ‹ connfdpλ¥Ό μ—¬λ¬ μ“°λ λ“κ°€ κ²½μν•  μ μλ‹¤.
>- β…ν™μ— λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ήν•λ©΄ β΅ **μƒλ΅μ΄ μ—°κ²°λ§λ‹¤ λ…λ¦½μ μΈ λ©”λ¨λ¦¬ κ³µκ°„**


### thread λ£¨ν‹΄ μ •ν•κΈ° 

1. *μ „λ‹¬λ°›μ€ connfd ν¬μΈν„° κ°’μ„ λ³µμ‚¬ν•μ—¬ μ •μκ°’ λ§λ“¬*
	- `int connfd = *((int *)vargp);
	- *ν•λ³€ν™ μ΄μ *
		- threadμƒμ„± μ‹μ— μ‹¤ν–‰λλ” λ©”μ„λ“λ” `void *`μΌλ΅ νλΌλ―Έν„΄κ°€ λ„μ–΄μ¤λ―€λ΅ 
	- *κ°’ λ³µμ‚¬ ν•λ” μ΄μ * 
		- μΈμλ΅ λ„μ–΄μ¨ ν¬μΈν„°λ” λ©”μΈ μ“°λ λ“κ°€ κ°–κ³  μ‡λ” ν¬μΈν„°μΈλ°, λ§μ•½ λ‹¤μ μ”μ²­μ΄ λ“¤μ–΄μ¤λ©΄ λ©”μΈ μ“°λ λ“λ” κ·Έ ν¬μΈν„° κ°’μ„ λ°”κΏ€ κ²ƒμ΄λ‹¤.
		- **μ΄ μƒν™©μ—μ„ μ²μ μμ‹ μ“°λ λ“κ°€ μ‘μ—…μ„ ν•λ©΄ λ‹¤λ¥Έ μ“°λ λ“μ—λ„ μν–¥μ„ λΌμΉκ² λ¨**
	  
2. *μ „λ‹¬λ°›μ€ connfd ν¬μΈν„° κ°’ Free*
	- `connfdp`λ” `Malloc`μ— μν•΄μ„ λ™μ μΌλ΅ ν• λ‹Ήλ κ²ƒμ΄λ‹¤. 
	- λ”°λΌμ„, μΌλ‹¨ κ°’ λ³µμ‚¬ν–μΌλ©΄ **λ©”λ¨λ¦¬ λ„μλ¥Ό λ§‰κΈ° μ„ν•΄ connfdλ¥Ό ν•΄μ **ν•λ©΄ λλ‹¤
	  
3. *λ©”μΈ μ‘μ—…* 
4. *fd μμ› μ²λ¦¬ (connfd)*

