---
{"dg-publish":true,"permalink":"/Computer_Science/Network/C-Network/Proxylab ìš”êµ¬ì‚¬í•­ ì •ë¦¬/","noteIcon":"","created":"2025-12-03T14:52:46.097+09:00","updated":"2025-12-09T17:19:41.889+09:00"}
---



https://wentao.site/proxylab/#:~:text=Source%3A-,proxylab.pdf,-Source%3A%20proxylab



## 4.1 HTTP/1.0 GET ìš”ì²­ 
`http://www.cmu.edu/hub/index.html`ê³¼ ê°™ì€ URLì„ ì…ë ¥í•˜ë©´, ë¸Œë¼ìš°ì €ëŠ” ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì¤„ë¡œ ì‹œì‘í•˜ëŠ” HTTP ìš”ì²­ì„ í”„ë¡ì‹œë¡œ ë³´ëƒ…ë‹ˆë‹¤. `GET http://www.cmu.edu/hub/index.html HTTP/1.1`

ì´ ìš”ì²­ì„ ë°›ì€ í”„ë¡ì‹œëŠ” ìµœì†Œí•œì˜ í•„ë“œë§Œ ìš”ì²­ 
ex. `GET /hub/index.html HTTP/1.0`   <<< **1.0ìœ¼ë¡œ ë§Œë“¤ê¸°** 


> [!WARNING]
HTTP ìš”ì²­ì˜ ëª¨ë“  ì¤„ì€ ìºë¦¬ì§€ ë¦¬í„´('\r')ê³¼ ì¤„ ë°”ê¿ˆ('\n')ìœ¼ë¡œ ëë‚˜ë©°, ëª¨ë“  HTTP ìš”ì²­ì€ **ë¹ˆ ì¤„ `"\r\n"`ë¡œ ì¢…ë£Œ**ëœë‹¤ëŠ” ì 

---
## 4.2 ìš”ì²­ í—¤ë” 

ì¤‘ìš”í•œ ìš”ì²­ í—¤ë”
- **Host**
- **User-Agent**
- **Connection**
- **Proxy-Connection**

---
#### 1. host
> Host í—¤ë”ëŠ” ìµœì¢… ì„œë²„ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì„¤ëª… : í•­ìƒ Host í—¤ë”ë¥¼ ë³´ë‚´ì•¼

ex. `http://www.cmu.edu/hub/index.html`ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ í”„ë¡ì‹œëŠ” ë‹¤ìŒ í—¤ë”ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. `Host: www.cmu.edu`

> [!WARNING] ë‹¨, Web Browerê°€ ìì²´ Host í—¤ë”ë¥¼ TTP ìš”ì²­ì— ì²¨ë¶€í•˜ëŠ” ê²½ìš°, í”„ë¡ì‹œëŠ” **ë¸Œë¼ìš°ì €ì™€ ë™ì¼í•œ Host í—¤ë”ë¥¼ ì‚¬ìš©**í•´ì•¼ í•¨ 

---
#### 2. User-Agent 
> í´ë¼ì´ì–¸íŠ¸(ìš´ì˜ ì²´ì œ, ë¸Œë¼ìš°ì € ë“±)ë¥¼ ì‹ë³„í•˜ë©°, ì›¹ ì„œë²„ëŠ” ì´ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œê³µí•˜ëŠ” ì½˜í…ì¸ ë¥¼ ì¡°ì‘í•˜ëŠ” í—¤ë” 

---
#### 3. Connection - close 
> í•­ìƒ Close

---
#### 4. Proxy-Connection - close
> - ì²« ìš”ì²­/ì‘ë‹µ êµí™˜ì´ ì™„ë£Œëœ í›„ ì—°ê²° ìœ ì§€ ì—¬ë¶€ë¥¼ ì§€ì • 
> - ì¦‰, ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ì—°ê²° ì—¬ëŠ” ê²ƒì´ í—ˆìš© 

---
#### 5. ê·¸ ì™¸ 
> ë‹¤ë¥¸ ìš”ì²­ í—¤ë”ë“¤ì€ ë³€ê²½ ì—†ì´ ê·¸ëŒ€ë¡œ ì „ë‹¬í•´ì•¼ í•œë‹¤.


---
## 4.3 í¬íŠ¸ ë²ˆí˜¸ 

ê³¼ì œì—ëŠ” 2ê°€ì§€ ì£¼ìš” í¬íŠ¸ ë²ˆí˜¸ê°€ ìˆë‹¤
1. HTTP ìš”ì²­ í¬íŠ¸
2. í”„ë¡ì‹œì˜ ìˆ˜ì‹  í¬íŠ¸ 

---
### 1. HTTP ìš”ì²­ í¬íŠ¸ 
- HTTP ìš”ì²­ URLì˜ ì„ íƒì  í•„ë“œì…ë‹ˆë‹¤. 
- ì˜ˆë¥¼ ë“¤ì–´, URLì´ `http://www.cmu.edu:8080/hub/index.html`ê³¼ ê°™ì€ í˜•ì‹ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
- ì´ ê²½ìš°, í”„ë¡ì‹œëŠ” ê¸°ë³¸ HTTP í¬íŠ¸ì¸ 80 ëŒ€ì‹  **8080 í¬íŠ¸ì˜ í˜¸ìŠ¤íŠ¸ `www.cmu.edu`ì— ì—°ê²°**í•´ì•¼ í•©ë‹ˆë‹¤. 
- í¬íŠ¸ ë²ˆí˜¸ê°€ URLì— í¬í•¨ë˜ë“  ê·¸ë ‡ì§€ ì•Šë“  í”„ë¡ì‹œëŠ” ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.

---
### 2. í”„ë¡ì‹œì˜ ìˆ˜ì‹  í¬íŠ¸ 
í”„ë¡ì‹œê°€ ë“¤ì–´ì˜¤ëŠ” ì—°ê²°ì„ ìˆ˜ì‹ í•˜ëŠ” í¬íŠ¸

- í”„ë¡ì‹œëŠ” ëª…ë ¹ì¤„ ì¸ìˆ˜ë¡œ ìˆ˜ì‹  í¬íŠ¸ ë²ˆí˜¸ë¥¼ ë°›ì•„ë“¤ì—¬ì•¼ í•©ë‹ˆë‹¤. 
- ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´ í”„ë¡ì‹œëŠ” **15213 í¬íŠ¸ì—ì„œ ì—°ê²°ì„ ìˆ˜ì‹ **í•´ì•¼ í•©ë‹ˆë‹¤. `linux> ./proxy 15213` 
- ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” **ë¹„íŠ¹ê¶Œ ìˆ˜ì‹  í¬íŠ¸(1,024ë³´ë‹¤ í¬ê³  65,536ë³´ë‹¤ ì‘ì€)** ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
- ê° ProxyëŠ” ê³ ìœ í•œ ìˆ˜ì‹  í¬íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê³  ì—¬ëŸ¬ ì‚¬ëŒì´ ë™ì‹œì— ì‘ì—…í•˜ê¸° ë•Œë¬¸ì—, ì‚¬ìš©ì IDì— ë”°ë¼ ê°œì¸ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” `port-for-user.pl` ìŠ¤í¬ë¦½íŠ¸ê°€ ì œê³µë©ë‹ˆë‹¤. 
- `linux> ./port-for-user.pl droh` `droh: 45806` `port-for-user.pl`ì´ ë°˜í™˜í•˜ëŠ” í¬íŠ¸ `p`ëŠ” **í•­ìƒ ì§ìˆ˜**ì…ë‹ˆë‹¤. 
- ë”°ë¼ì„œ Tiny ì„œë²„ì™€ ê°™ì€ ì¶”ê°€ í¬íŠ¸ ë²ˆí˜¸ê°€ í•„ìš”í•œ ê²½ìš°, **í¬íŠ¸ `p`ì™€ `p + 1`ì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ë¬´ì‘ìœ„ í¬íŠ¸ë¥¼ ì„ íƒí•˜ì§€ ë§ˆì„¸ìš”. ê·¸ë ‡ê²Œ í•˜ë©´ ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ì¶©ëŒí•  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.** â­

---
## 5.2 ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ 
> ì´ì œ ì—¬ëŸ¬ ìš”ì²­ì„ ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •


---
# ìºì‹± 

---
### ì¡°ê±´ 1. í¬ê¸° 
```c
#define MAX_CACHE_SIZE 1049000
#define MAX_OBJECT_SIZE 102400
```

1. **ìºì‹œ ìµœëŒ€ í¬ê¸°** = 1MB  
2. **ìµœëŒ€ ìºì‹± ê°ì²´ í¬ê¸°** = 100KB

>[!tip] pdf æ›° ìºì‹œ êµ¬í˜„ hint
>1. *ì—°ê²°ë§ˆë‹¤ ì „ìš© ë²„í¼ë¥¼ í• ë‹¹í•œë‹¤*
>2. *ë°ì´í„° í¬ê¸° ê²€ì‚¬ ë° ëˆ„ì *
>	- ì„œë²„ê°€ ë°ì´í„° ë³´ë‚´ì£¼ë©´ **í¬ê¸° ê²€ì‚¬ ë° ì„ì‹œ ë²„í¼ì— ë°ì´í„° ëˆ„ì ** 
>	- ëˆ„ì  í›„ buffer_objectê°€ 100KBê°€ ì•ˆë„˜ëŠ”ì§€ í™•ì¸ 
>3. *buf íê¸° ë° ê°±ì‹ *
>	- buf_object í¬ê¸°ê°€ 100KB **ì´ˆê³¼ ì‹œ ì„ì‹œ ë²„í¼ë¥¼ ì¦‰ì‹œ íê¸°** ğŸ¥Š
>	- *ì–¸ì œ ë©”ì¸ ìºì‹œì— ì˜¬ë¦¬ëŠ”ê°€â“*
>		- ì„ì‹œ ë²„í¼ì— ëˆ„ì ëœ ë°ì´í„°ë“¤ì´ í¬ê¸° ê²€ì‚¬ í†µê³¼í•˜ë©´ì„œ ëª¨ë‘ ë„ì°©í–ˆì„ ë•Œ!!!<br>
>4. âœ…ì´ ì „ëµ ì‹œ Proxyê°€ ì‚¬ìš©í•˜ëŠ” ìµœëŒ€ ë©”ëª¨ë¦¬ ì–‘ = `MAX_CACHE_SIZE + T * MAX_OBJECT_SIZE`
>	- `MAX_CACHE_SIZE` : í”„ë¡ì‹œì˜ ë©”ì¸ ìºì‹œê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ í¬ê¸°
>	- `T` : ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ í™œì„± ì—°ê²° ìˆ˜ 
>	- `T * MAX_OBJECT_SIZE` : ëª¨ë“  ì„ì‹œ ë²„í¼ í¬ê¸°ì˜ í•© (â—ì´ëŠ” **ìºì‹œì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ì¶”ê°€ ë©”ëª¨ë¦¬**)


í ... ìºì‹œ ë²„í¼ëŠ” ìŠ¤ë ˆë“œ í•¨ìˆ˜ ë‚´ì—ì„œ êµ¬ì¡°ì²´ ì„ ì–¸í•˜ê³ , ì „ì²´ ìºì‹œëŠ” ì „ì—­ ë³€ìˆ˜ë¡œí•˜ê³  **ì½ê¸°ëŠ” ê³µìœ ë˜ê³  ì“°ê¸°ëŠ” ë½ê±¸ê¸°**

---
### ì¡°ê±´ 2. ì œê±° ì •ì±… 

> LRU ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©í•˜ê¸° (Least Recently Used Algorithm)
> - ê°€ì¥ ì˜¤ë«ë™ì•ˆ ì°¸ì¡°ë˜ì§€ ì•Šì€ í˜ì´ì§€ êµì²´í•˜ëŠ” ê¸°ë²• 

> [!WARNING] ì£¼ì˜ : ê°ì²´ë¥¼ ì½ëŠ” ê²ƒê³¼ ì“°ëŠ” ê²ƒ ëª¨ë‘ ê°ì²´ ì‚¬ìš©ìœ¼ë¡œ ê°„ì£¼

---
### ì¡°ê±´3. ë™ê¸°í™” 
1. **ì—¬ëŸ¬ threadê°€ ë™ì‹œì— ìºì‹œë¥¼ ì½ì„ ìˆ˜ ìˆì–´ì•¼** í•¨  â¡ `pthread_rwlock_t` å¿…
2. ì“°ê¸° ì‘ì—…ì€  thread-safeí•˜ê²Œ í•˜ê¸° 

> [!WARNING] ë°°íƒ€ì  ë½ ë¶ˆê°€ëŠ¥ 
> í• ê±°ë©´
> 1. ìºì‹œ ë¶„í• í•˜ê±°ë‚˜
> 2. Pthreadsì˜ readers-writers locksë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ 
> 3. ì„¸ë§ˆí¬ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ readers-writers êµ¬í˜„ 

