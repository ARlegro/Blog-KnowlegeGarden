---
{"dg-publish":true,"permalink":"/Computer_Science/Virtual_Memory/ë™ì  ë©”ëª¨ë¦¬(3) - ~ì  ê°€ìš© ë¦¬ìŠ¤íŠ¸/","noteIcon":"","created":"2025-08-22T17:00:37.293+09:00","updated":"2025-09-05T02:38:25.178+09:00"}
---


*ë¬µì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸(Implicit Free List)*

[[Computer_Science/Malloc/íš¨ìœ¨ì ì¸ í• ë‹¹ê¸° êµ¬í˜„ ì‹œ ê³ ë ¤ì‚¬í•­\|íš¨ìœ¨ì ì¸ í• ë‹¹ê¸° êµ¬í˜„ ì‹œ ê³ ë ¤ì‚¬í•­]]

>[!tip] ë¬µì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸ vs ëª…ì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸ 
>ê°€ìš© Blockì„ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ëŠëƒì— ë”°ë¼ **ë¬µì‹œì /ëª…ì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸ë¡œ** ê°ˆë¦°ë‹¤.
>ê°€ì¥ í° ì°¨ì´ëŠ”
>- *ë¬µì‹œì  êµ¬í˜„* : free blockì„ ë”°ë¡œ ëª¨ì•„ë‘ì§€ ì•ŠëŠ”ë‹¤
>- *ëª…ì‹œì  êµ¬í˜„* : free blockë¼ë¦¬ë§Œ ì—°ê²°ë¦¬ìŠ¤íŠ¸ë¡œ ë¬¶ì–´ë‘  


---
## 1. ë¬µì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸ 

#ë‹¨ìˆœ 

---
### ê°œë… 
> ë©”ëª¨ë¦¬ í™ì˜ ëª¨ë“  ë¸”ë¡ì„ ì—°ì†ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ë°©ì‹ 

- ê°€ìš©(free) ë¸”ë¡ì„ ë”°ë¡œ ëª¨ì•„ë‘ì§€ ì•ŠëŠ”ë‹¤.
- ì „ì²´ í™ì„ ì„ í˜•ìœ¼ë¡œ íƒìƒ‰í•˜ì—¬ í•„ìš”í•œ ë¸”ë¡ì„ ì°¾ìŒ â¡ ëŠë¦¼ ($O(ì „ì²´ë¸”ë¡ìˆ˜)$) ğŸ’¢


---
### ê¸°ë³¸(Regular) ë¸”ë¡ êµ¬ì¡° 
![Pasted image 20250823215657.png](/img/user/supporter/image/Pasted%20image%2020250823215657.png)
![Pasted image 20250823112649.png](/img/user/supporter/image/Pasted%20image%2020250823112649.png)

ëª¨ë“  Blockì€ `[Header | Payload | Footer]` êµ¬ì¡°ì´ë‹¤
- *Header* : ë¸”ë¡ì˜ í¬ê¸°ì™€ í• ë‹¹ ì—¬ë¶€ ì •ë³´ë¥¼ ë‹´ê³  ì‡ìŒ 
- *Payload* : ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê³³ 
- *Footer* : í—¤ë”ì™€ ë™ì¼í•œ ì •ë³´ ê°€ì§. **ë³‘í•© ì‹œ ì´ì „ ë¸”ë¡ì˜ ì •ë³´ë¥¼ ë¹ ë¥´ê²Œ ì°¾ê¸° ìœ„í•´** ì‚¬ìš© 

---
### íŠ¹ë³„í•œ ë¸”ë¡ 

> - **ê²½ê³„ ì¡°ê±´ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ íŠ¹ë³„íˆ** ë§Œë“¤ì–´ì§„ ë¸”ë¡ì´ ìˆë‹¤. 
> 	1. í”„ë¡¤ë¡œê·¸ ë¸”ë¡
> 	2. ì—í•„ë¡œê·¸ ë¸”ë¡ 
> - ì´ ë¸”ë¡ë“¤ì€ **í™ì˜ ì‹œì‘ê³¼ ëì— ìœ„ì¹˜**
> - ì—£ì§€ ì¼€ì´ìŠ¤ë¥¼ ì œê±°í•  ìˆ˜ ìˆì–´ì„œ í• ë‹¹ìì˜ **ì½”ë“œë¥¼ ë‹¨ìˆœí™”**í•˜ëŠ” ì—­í•  
> 	- ë‹¤ìŒ/ì´ì „ ë¸”ë¡ì˜ ìƒíƒœë¥¼ í™•ì¸í•  ê²½ìš°ê°€ ë§ì„í…ë° í•­ìƒ ì•ˆì „í•˜ê²Œ í™•ì¸ ê°€ëŠ¥ 

---
#### í™ì˜ì—­ 
```bash
âœ…| Padding (8B) |  
âœ…| Prologue Header (8B, size=16, alloc=1) |
âœ…| Prologue Footer (8B, size=16, alloc=1) |
| First Free Block (ê°€ë³€) |
... Regular Blacks 
| Last Free/Allocated Block |
âœ…| Epilogue Header (8B, size=0, alloc=1) |
```
- Padding : ì •ë ¬ ë§ì¶”ê¸°ìš©
- Prologue : í™ ì• ë³´í˜¸ ì¥ì¹˜
- Regular Blocks: malloc/free ë˜ëŠ” ì‹¤ì œ ê³µê°„
- Epilogue : í™ ë ë³´í˜¸ ì¥ì¹˜

Regular Block ì™¸ íŠ¹ë³„í•œ ë¸”ë¡ë“¤ì´ ìˆëŠ”ë° ê·¸ê²ƒì„ ì•Œì•„ë³¼ ê²ƒ 
- Padding
- Prologue block
- Epilogue block

---
#### 0. íŒ¨ë”© ë¸”ë¡ 
```c
PUT(heap_listp, 0);
```
- *ì •ë ¬ìš© íŒ¨ë”©* : ì•„ë¬´ ì˜ë¯¸ ì—†ëŠ” 0 ëŒ€ì… (ìˆ«ìëŠ” í¬ê²Œ ìƒê´€ì—†ìŒ)
- ë¸”ë¡ì˜ **bpë¥¼ ë”ë¸”ì›Œë“œ ì‚¬ì´ì¦ˆ ë‹¨ìœ„ë¡œ ë§ì¶”ê¸° ìœ„í•´** ë§Œë“œëŠ” ë”ë¯¸ ë¸”ë¡ 

![Pasted image 20250823204155.png](/img/user/supporter/image/Pasted%20image%2020250823204155.png)
>[!tip] í™ ë¸”ë¡ì˜ ë”ë¸”ì›Œë“œ(8B) ì •ë ¬ ê·œì¹™
> - ëª¨ë“  payloadëŠ” 8ì˜ ë°°ìˆ˜ ì£¼ì†Œì—ì„œ ì‹œì‘í•´ì•¼ 
> - Cuz CPUì˜ ì½ê¸°/ì“°ê¸° ì‹œ ì„±ëŠ¥ê³¼ ì•ˆì „ì„± ë•Œë¬¸ 

---
#### 1. í”„ë¡¤ë¡œê·¸(Prologue) ë¸”ë¡
```bash
[ Header (8B, size=16, alloc=1) | Footer (8B, size=16, alloc=1) ]
```
- Payloadê°€ ì—†ì´ headerì™€ footerë¡œë§Œ ì´ë£¨ì–´ì§„ ë¸”ë¡ 
- *í¬ê¸°* 
	- ë³´í†µ **ìµœì†Œ ë¸”ë¡ í¬ê¸°**ë¡œ í•˜ëŠ” ê²ƒì´ í”í•¨(16byte)
	  
- *ì—­í• * 
	- **í™ì˜ ì²« ë²ˆì§¸ ë¸”ë¡ì´ ì´ì „ ë¸”ë¡ê³¼ ë³‘í•©í•˜ë ¤ëŠ” ì‹œë„ë¥¼ ë§‰ì•„**ì¤€ë‹¤
	- ë•ë¶„ì—, ìœ íš¨í•˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬ ì£¼ì†Œ ì ‘ê·¼í•˜ëŠ” ì˜¤ë¥˜ë¥¼ ë°©ì§€ ê°€ëŠ¥ 
	  
- **í™ì˜ ë§¨ ì²˜ìŒ**ì— ìœ„ì¹˜ 
- `alloc=1` : í•­ìƒ í• ë‹¹ëœ ìƒíƒœ 

---
#### 2. ì—í•„ë¡œê·¸(Epilogue) ë¸”ë¡ 

```bash
[ Header (8B, size=0, alloc=1) ]
```

> [!WARNING] ì—í•„ë¡œê·¸ëŠ” ì‹¤ì œ ë¸”ë¡ì´ ì•„ë‹ˆë‹¤.

- í¬ê¸° : 0 byte
- *ë‹¨ìˆœ ê²½ê³„ìš©* 
	- í™ ëì„ ì•Œë ¤ì£¼ëŠ” sentinel 
	- í™ì˜ ë§ˆì§€ë§‰ ë¸”ë¡ì´ ë‹¤ìŒ ë¸”ë¡ê³¼ ë³‘í•©í•˜ë ¤ëŠ” ì‹œë„ë¥¼ ë§‰ì•„ì¤Œ 
	  
- í™ì˜ ë§¨ ëì— ìœ„ì¹˜ 
- `alloc=1` : í•­ìƒ í• ë‹¹ëœ ìƒíƒœ 

---
## 2. ëª…ì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸ 

> [!WARNING] ë¬µì‹œì  ê°€ìš© ë¦¬ìŠ¤íŠ¸ì˜ í•œê³„ 
> - ë¸”ë¡ í• ë‹¹/í•´ì œ ì‹œê°„ì´ ì „ì²´ í™ ë¸”ë¡ìˆ˜ì— ë¹„ë¡€ 

> ê°€ìš© ë¸”ë¡ë“¤ì„ ì—°ê²° ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•
> - *í•µì‹¬* : ê°€ìš© ë¸”ë¡ë“¤ë§Œ ê´€ë¦¬ â—
> - ê° ê°€ìš© ë¸”ë¡ë“¤ì€ **ë‹¤ìŒ ê°€ìš© ë¸”ë¡ì˜ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°ê°€ ë“¤ì–´** ìˆë‹¤.


ê°€ìš© ë¦¬ìŠ¤íŠ¸ 
- ê°€ìš© ë¸”ë¡ë§Œ ì—°ê²°í•œ ë³„ë„ì˜ ì—°ê²° ë¦¬ìŠ¤íŠ¸ 
- ê° ê°€ìš© blockì˜ Payload => ì „ì„/í›„ì„ í¬ì¸í„°ë¥¼ ì €ì¥ 

---
### í• ë‹¹ ì‹œ 
![Pasted image 20250825160004.png](/img/user/supporter/image/Pasted%20image%2020250825160004.png)
- White Block = ê°€ìš© ë¦¬ìŠ¤íŠ¸ block
- í• ë‹¹ë˜ê³  ë¶„í• ëœ ê°€ìš© ë¸”ë¡ì„ ë‹¤ì‹œ ë¦¬ìŠ¤íŠ¸ë¡œ 

ì• ë’¤ ë°”ê¾¸ë©´ ë˜ëŠ”ê±°ë¼ ê°„ë‹¨

---
### Free ì‹œ 
ì‚´ì§ ë” ë³µì¡í•˜ë‹¤ Cuz ì‚½ì… ì •ì±… 
ì‚½ì… ì •ì±… = ìƒˆë¡œ í•´ì œëœ ë¸”ë¡ì„ ê°€ìš© ë¦¬ìŠ¤íŠ¸ì˜ ì–´ë””ì— ë†“ì„ì§€

ì‚½ì… ì •ì±… 2ê°€ì§€ ì¢…ë¥˜
1. *LIFO (í›„ì… ì„ ì¶œ)* 
	- ì‚¬ìš© ê°€ëŠ¥ Blockì´ ìƒê¸°ë©´ ë¦¬ìŠ¤íŠ¸ì˜ ê°€ì¥ ì• ë¶€ë¶„ì— ì‚½ì… 
	- ë¦¬ìŠ¤íŠ¸ **ì‹œì‘ ë¶€ë¶„ì— í¬ì¸í„°ê°€ í•­ìƒ** ìˆê¸° ë•Œë¬¸ì— ìƒë‹¹íˆ **ê°„ë‹¨**í•˜ê³  ìƒìˆ˜ ì‹œê°„
	- ì—°êµ¬ ê²°ê³¼ ì´ê²Œ ë” ë‚«ë‹¤ëŠ¥
	  
2. *ì£¼ì†Œ ìˆœì„œ*
	- ì£¼ì†Œ ìˆœìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ ì •ë ¬ë˜ì–´ ì‡ìŒ 
	- ì¥ì  : 1ë²ˆ ë³´ë‹¤ ë‹¨í¸í™”ê°€ ì ë‹¤. 
	- ë‹¨ì  : free ì‹œ ì„ í˜• ê²€ìƒ‰ ì‹œê°„ å¿…

---
#### LIFO - Case 1 : ì¸ì ‘ ê°€ìš© ë¸”ë¡ X
> ì¸ì ‘ ê°€ìš© ë¸”ë¡ì´ ì—†ëŠ” ê²½ìš°

![Pasted image 20250825173106.png](/img/user/supporter/image/Pasted%20image%2020250825173106.png)
- ê·¸ëƒ¥ listì˜ rootì— ê°€ìš©ëœ blockì„ ë„£ìœ¼ë©´ ë¨ (ë³‘í•© í•„ìš”âŒ)
	- root = ê°€ìš© ë¦¬ìŠ¤íŠ¸ì˜ headë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„° 
![Pasted image 20250825164909.png](/img/user/supporter/image/Pasted%20image%2020250825164909.png)

---
#### LIFO - Case 2 : ì´ì „ ë¸”ë¡ì´ ê°€ìš©
> ì´ì „ ë¬¼ë¦¬ ë¸”ë¡ì´ ê°€ìš© ìƒíƒœì¸ ê²½ìš° 

![Pasted image 20250825173241.png](/img/user/supporter/image/Pasted%20image%2020250825173241.png)

ì´ì „ ë¸”ë¡ì´ ê°€ìš©ì´ë¯€ë¡œ í˜„ì¬ free()í•˜ë ¤ëŠ” ë¸”ë¡ê³¼ ë³‘í•©í•´ì„œ ë” í° ê°€ìš© ë¸”ë¡ì„ ë§Œë“ ë‹¤.
1. ì´ì „ ê°€ìš© ë¸”ë¡ê³¼ ë³‘í•©
2. ê²°ê³¼ ë¸”ë¡ì„ ë¦¬ìŠ¤íŠ¸ì— ë„£ê¸° 
3. rootê°€ ì´ ë¸”ë¡ì„ ê°€ë¦¬í‚¤ë„ë¡ 

---
#### LIFO - Case 3 : ë‹¤ìŒ ë¸”ë¡ì´ ê°€ìš©
> ë‹¤ìŒ ë¬¼ë¦¬ ë¸”ë¡ì´ ê°€ìš© ìƒíƒœì¸ ê²½ìš° 

![Pasted image 20250825173417.png](/img/user/supporter/image/Pasted%20image%2020250825173417.png)

Case 2ì™€ ë¹„ìŠ·í•˜ê²Œ í•˜ë©´ ë¨ 

---
#### LIFO - Case 4 : ì´ì „,ë‹¤ìŒ ë¸”ë¡ì´ ê°€ìš© 

3ê°œ ì „ë¶€ ë³‘í•©í•˜ë©´ ë¨ 

---
### êµ¬í˜„ ì‹œ ì¡°ì‹¬                                                                                                                
1. *ìµœì†Œ ê°€ìš© ë¸”ë¡ì„ ì¬ì •ì˜ í•´ì•¼ í•¨ *
	- ì´ì „/ë‹¤ìŒ ë¸”ë¡ì˜ ì •ë³´ë¥¼ ë‹´ì„ ë¸”ë¡ì´ í•„ìš”í•˜ë¯€ë¡œ ìµœì†Œ í¬ê¸°ë¥¼ ê¸°ì¡´ë³´ë‹¤ ëŠ˜ë ¤ì•¼ í•œë‹¤.
	- ì´ë¡œ ì¸í•´, split ì¡°ê±´ë„ ë°”ê¿”ì•¼ í•¨ 
	- Note : **í¬ì¸í„°ëŠ” 8Bê°€ í•„ìš”** (64bit ê¸°ì¤€) Cuz ê°€ìƒ ì£¼ì†Œ í­ì´ 64bitì—¬ì„œ í¬ì¸í„°ë„ ê·¸ê±° ë§ì¶°ì•¼ 
	  
2. ì´ì¤‘ í¬ì¸í„° ì‚¬ìš© 

---
## ë¶„ë¦¬ ê°€ìš© ë¦¬ìŠ¤íŠ¸ 

---
### í•µì‹¬ ì•„ì´ë””ì–´ 
1. *ì—¬ëŸ¬ ê°œì˜ ê°€ìš© ë¦¬ìŠ¤íŠ¸* 
	- **í¬ê¸° ë²”ìœ„ë³„ë¡œ** ì—¬ëŸ¬ ê°œì˜ **ê°€ìš© ë¦¬ìŠ¤íŠ¸**ë¥¼ ë‘”ë‹¤ 
		```c
		// Segregated Free List: í¬ê¸°ë³„ë¡œ ë¶„ë¦¬ëœ ê°€ìš© ë¦¬ìŠ¤íŠ¸ ë°°ì—´
		static void *free_lists[NUM_LISTS];
		/**
		Â * ì£¼ì–´ì§„ í¬ê¸°ì— í•´ë‹¹í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ì˜ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜
		Â */
		static int get_list_index(size_t size) {
		Â  Â  // 2ì˜ ê±°ë“­ì œê³±ì„ ê¸°ì¤€ìœ¼ë¡œ í¬ê¸° í´ë˜ìŠ¤ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.
		Â  Â  // ì˜ˆ: list[0] -> (0, 32], list[1] -> (32, 64], list[2] -> (64, 128] ...
		Â  Â  if (size <= 32) return 0;
		Â  Â  if (size <= 64) return 1;
		Â  Â  if (size <= 128) return 2;
		Â  Â  if (size <= 256) return 3;
		Â  Â  if (size <= 512) return 4;
		Â  Â  if (size <= 1024) return 5;
		Â  Â  if (size <= 2048) return 6;
		Â  Â  if (size <= 4096) return 7;
		Â  Â  if (size <= 8192) return 8;
		Â  Â  if (size <= 16384) return 9;
		Â  Â  // ... í•„ìš”ì— ë”°ë¼ ë” ë§ì€ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		Â  Â  return 10; // ê°€ì¥ í° í´ë˜ìŠ¤
		}
		```
	  
2. *ë¹ ë¥¸ ê²€ìƒ‰*
	- `malloc`ìš”ì²­ ì‹œ **í•„ìš”í•œ í¬ê¸°ì— ì†í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ë§Œ** ê²€ìƒ‰ 
	  
---
### init 
- ê°€ìš© ë¸”ë¡ì˜ í´ë˜ìŠ¤ 
  
```c
#define NUM_LISTS 20 // ì‚¬ìš©í•  ê°€ìš© ë¦¬ìŠ¤íŠ¸ì˜ ê°œìˆ˜
// Segregated Free List: í¬ê¸°ë³„ë¡œ ë¶„ë¦¬ëœ ê°€ìš© ë¦¬ìŠ¤íŠ¸ ë°°ì—´
static void *free_lists[NUM_LISTS];
int mm_init(void)
		
		// ë¶„ë¦¬ ê°€ìš© ë¦¬ìŠ¤íŠ¸ ë°°ì—´ ì›ì†Œë“¤ nullë¡œ ì „ë¶€ ì´ˆê¸°í™” 
Â  Â  for (int i = 0; i < NUM_LISTS; i++) {
Â  Â  Â  Â  free_lists[i] = NULL;
Â  Â  }

Â  Â  heap_listp = mem_sbrk(4 * WSIZE);
{
```
`free_lists[]`
- í¬ê¸°ë³„ë¡œ ë¶„ë¦¬ëœ ê°€ìš© ë¦¬ìŠ¤íŠ¸ ë°°ì—´
- *ì „ì—­ ì •ì  ë³€ìˆ˜*
	- âŒí™ ì˜ì—­ì— ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤ â¡ ë³„ë„ë¡œ í™ì— ë°°ì¹˜í•  í•„ìš”ê°€ ì—†ìŒ 
	- í”„ë¡œê·¸ë¨ì˜ `.bss/.data ì˜ì—­`ì— ë†“ì„ 

---
### Insert ì‹œ 

```c
// LIFOë¡œ ê°€ìš© ë¦¬ìŠ¤íŠ¸ì˜ ë§¨ ì•ì— ë¸”ë¡ì„ ì‚½ì…
static void insert_free(char *bp) {
Â  Â  size_t size = GET_SIZE(HDRP(bp));
Â  Â  int index = get_list_index(size);
Â  Â  void *list_head = free_lists[index];

Â  Â  // ì‚½ì…í•˜ë ¤ëŠ” ê°€ìš© ë¸”ë¡ê³¼ ì´ì „ ëŒ€ì¥ì´ì˜€ë˜ ë¸”ë¡ link
Â  Â  PUT_SUCC_PTR(bp, list_head);
Â  Â  if (list_head != NULL) {
Â  Â  Â  Â  PUT_PRED_PTR(list_head, bp);
Â  Â  }

Â  Â  PUT_PRED_PTR(bp, NULL);
Â  Â  free_lists[index] = bp;
}
```

---
### remove_free

```c
void remove_free(char *bp){
Â  Â  size_t size = GET_SIZE(HDRP(bp));
Â  Â  int index = get_list_index(size);
Â  Â  void *pred = GET_PRED_PTR(bp);
Â  Â  void *succ = GET_SUCC_PTR(bp);

Â  Â  if (pred) {
Â  Â  Â  Â  PUT_SUCC_PTR(pred, succ);
Â  Â  } else {
	Â  Â  // bpì˜ pred = null  ==> bpê°€ headë¼ëŠ” ê²ƒ
Â  Â  Â  Â  free_lists[index] = succ; Â // bpê°€ ì²« ë²ˆì§¸ ë…¸ë“œ
Â  Â  }

Â  Â  if (succ) {
Â  Â  Â  Â  PUT_PRED_PTR(succ, pred);
Â  Â  }
}
```

