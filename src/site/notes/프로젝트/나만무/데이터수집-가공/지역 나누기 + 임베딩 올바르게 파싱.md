---
{"dg-publish":true,"permalink":"/í”„ë¡œì íŠ¸/ë‚˜ë§Œë¬´/ë°ì´í„°ìˆ˜ì§‘-ê°€ê³µ/ì§€ì—­ ë‚˜ëˆ„ê¸° + ì„ë² ë”© ì˜¬ë°”ë¥´ê²Œ íŒŒì‹±/","noteIcon":"","created":"2025-12-03T14:53:07.064+09:00","updated":"2025-12-10T13:57:06.552+09:00"}
---



ìš”êµ¬ ì‚¬í•­
- ì‚¬ìš©ìì˜ ì„±í–¥ê³¼ ì‚¬ìš©ìê°€ ì •í•œ ì§€ì—­ì˜ ë²”ìœ„ ë‚´ì—ì„œ DBì— ì €ì¥ëœ ì¥ì†Œ ë°ì´í„°ë“¤ì„ ê°€ì ¸ì™€ì„œ ë§¤ì¹­í•´ì£¼ê¸° 

*í•„ìš”í•œ ë‚´ìš©*
1. *ì„ë² ë”© ë°ì´í„°* - ì¤€ë¹„ ê±°ì˜ ì™„ë£Œ 
	- ì´ë¯¸ ì‚¬ìš©ì ì„±í–¥ì€ ì„ë² ë”©ì´ ë˜ì–´ìˆê³ 
	- TourAPIì—ì„œ ê°€ì ¸ì˜¨ 3ë§Œ 3ì²œê°œì˜ ì¥ì†Œ ë°ì´í„°ê°€ ìˆë‹¤. í˜„ì¬ëŠ” ê·¸ ë°ì´í„°ë“¤ì„ **"ë„¤ì´ë²„ ê²€ìƒ‰ APIë¥¼ í†µí•œ ë¦¬ë·° ì¶”ì¶œ-í¬ë¡¤ë§-ì •ì œ-ì„ë² ë”©-í…Œê·¸ ê³¼ì •ì˜ pipeline"** ìœ¼ë¡œ ECS fargateì—ì„œ ëŒë¦¬ê³  ìˆë‹¤. ì´í‹€ ë™ì•ˆ 2000ê°œ ì¥ì†Œë°ì´í„°ë¥¼ ì²˜ë¦¬í•œê±´ë°... ì•ìœ¼ë¡œ ë°œí‘œê¹Œì§€ 15ì¼ ì •ë„? ëª¨ë“  ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ëŠ” ì—†ì„ ê²ƒ ê°™ê¸´ í•˜ë‹¤.
	  
2. *ì§€ì—­ ë²”ìœ„ë¡œ ë‚˜ëˆ„ê¸° â¬…â¬…â¬…*
	- ì´ê²Œ ë¬¸ì œì¸ë°...
	- í˜„ì¬ ì•„ë˜ ì‚¬ì§„ì²˜ëŸ¼ ì €ì¥ë˜ì–´ ìˆê¸´ í•œë°, APIí˜¸ì¶œë¡œ ë¶ˆëŸ¬ì˜¨ê±°ë¼ ë°˜ë“œì‹œ íŠ¹ì • íŒ¨í„´ìœ¼ë¡œ ì €ì¥ë˜ì—ˆë‹¤ëŠ” ë³´ì¥ì´ ì—†ì–´ì„œ(ex. ì„œìš¸ì‹œ - ì„œìš¸ íŠ¹ë³„ì‹œ) í™•ì¸ì„ í•´ë´ì•¼ í•  ê²ƒ ê°™ë‹¤.

---
## 1.  ì§€ì—­ ë‚˜ëˆ„ê¸°

---
### 1.1.  ì£¼ì†Œê°’ì´ ì–´ë–»ê²Œ ë¶„í¬ë¼ ìˆëŠ”ì§€ í™•ì¸ 
> ì‹¤ì œë¡œ ì„œìš¸ ì£¼ì†Œë“¤ì´ ì„œìš¸íŠ¹ë³„ì‹œë¡œ ë˜ì–´ìˆëŠ”ì§€ ë“±ì„ í™•ì¸í•˜ëŠ” ì‘ì—…


```sql
SELECT 
split_part(address, ' ', 1) AS sido
, COUNT(*)
FROM places
WHERE address IS NOT NULL AND address <> '' -- <> : ê°™ì§€ ì•Šë‹¤
GROUP BY 1 -- SELECT ì ˆì˜ ì²« ë²ˆì§¸ ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ GROUP BY
ORDER BY 1 -- SELECT ì ˆì˜ ì²« ë²ˆì§¸ ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ORDER BY
```
![Pasted image 20251114191059.png](/img/user/supporter/image/Pasted%20image%2020251114191059.png)

---
### 1.2.  ì§€ì—­ ë‚˜ëˆ„ê¸° 
ìœ„ì˜ ì‚¬ì§„ìœ¼ë¡œ ì£¼ì†Œê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ë° ë¬¶ëŠ” ì‘ì—…ì´ å¿…

- ì„œìš¸íŠ¹ë³„ì‹œ â†’ ì„œìš¸
- ê²½ê¸°ë„ â†’ ê²½ê¸°ë„
- ì¸ì²œê´‘ì—­ì‹œ â†’ ì¸ì²œ
- ê°•ì›íŠ¹ë³„ìì¹˜ë„ â†’ ê°•ì›ë„
- ë¶€ì‚°ê´‘ì—­ì‹œ â†’ ë¶€ì‚°
- ê²½ìƒë‚¨ë„, ê²½ìƒë¶ë„, ëŒ€êµ¬ê´‘ì—­ì‹œ, ìš¸ì‚°(ê´‘ì—­ì‹œ) â†’ ê²½ìƒë„ _(í”„ë¡ íŠ¸ì—ì„œëŠ” ë¶€ì‚° ì œì™¸)_
- ì „ë¼ë‚¨ë„, ì „ë¶íŠ¹ë³„ìì¹˜ë„, ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ â†’ ì „ë¼ë„
- ì œì£¼íŠ¹ë³„ìì¹˜ë„ â†’ ì œì£¼ë„
- ì¶©ì²­ë‚¨ë„, ì¶©ì²­ë¶ë„, ëŒ€ì „ê´‘ì—­ì‹œ â†’ ì¶©ì²­ë„

> ì„œìš¸ / ê²½ê¸° / ì¸ì²œ / ê°•ì›ë„ / ë¶€ì‚° / ê²½ìƒë„ / ì „ë¼ë„ / ì¶©ì²­ë„ / ì œì£¼ë„

---
### 1.3.  SQLë¬¸ 

1. í•„ë“œ ì¶”ê°€ 
	```sql
	alter table places
	add column region_group region_group_enum;
	```

2. case ë³€í™˜ 
	- íŒŒì´ì¬ìœ¼ë¡œ ì‘ì„±í• ê¹Œ í•˜ë‹¤ê°€...ì§€ê¸ˆ ë‹¹ì¥ ì½”ì¹˜ë‹˜ì´ ë¹ ë¥´ê²Œ ì¤€ë¹„í•˜ë¼í•´ì„œ ê·¸ëƒ¥ ë¹ ë¥´ê²Œ SQLë¬¸ìœ¼ë¡œ ì¢…ë£Œë¥¼  ì‹œì¼°ë‹¤.
	- ì¶”í›„ ìˆ˜ì§‘ë˜ëŠ” ë°ì´í„°ëŠ” REGIONë‚˜ë‰˜ë„ë¡ ë‹¤ì‹œ ì½”ë“œë¥¼ ì§œì•¼ë˜ê¸´í•œë‹¤(ì¼ë‹¨ ì§€ê¸ˆ ë°ì´í„°ë§Œì€)
	```SQL
	WITH normalized AS (
	    SELECT 
	        id,
	        regexp_replace(
	            split_part(address, ' ', 1),
	            '(íŠ¹ë³„ì‹œ|ê´‘ì—­ì‹œ|íŠ¹ë³„ìì¹˜ì‹œ|íŠ¹ë³„ìì¹˜ë„|ë„)


---
### 1.4.  ì½”ë“œ ë³€ê²½

---
## 2.  ì„±í–¥ ì„ë² ë”© ê¸°ë°˜ ì¥ì†Œ ì¶”ì²œ 
---
### 2.1.  ë¬¸ì œ ğŸ’¢
```txt
code: '22P02',
detail: 'Vector contents must start with "[".',
where: "unnamed portal parameter $2 = '\"0.0009724678\",\"0.031838484\", ... ,\"-0.026442131\"'"
file: 'vector.c',
routine: 'vector_in'
```
- vectorëŠ” [ 1, 2, 3, 4, 5]

```js
Â  Â  const embeddingValue = await this.profileService.getUserEmbeddingValueByUserId(userId);
Â  Â  const places: Place[] = await this.placeRepo
Â  Â  Â  .createQueryBuilder('p')
Â  Â  Â  .where('p.region = :region', { region })
Â  Â  Â  .orderBy('p.embedding <=> :embedding', 'ASC')
Â  Â  Â  .setParameters({ embedding: embeddingString }) âŒ
Â  Â  Â  .limit(50)
Â  Â  Â  .getMany()Â  Â  Â  
```

ì„ë² ë”© ê°’ì„ ë‹¤ë£¨ëŠ”ê±°ëŠ” ì²˜ìŒì´ë¼ í—·ê°ˆë ¸ë‹¤.
ë¶„ëª… Place entityì˜ embeddingê°’ì€ ì•„ë˜ì™€ ê°™ì€ë° ì‹¤ì œ ë„˜ì–´ì˜¨ vectorê°’ì€ ë¬¸ìì—´ì˜ { } ê´„í˜¸ê°€ ìˆëŠ” **ë¬¸ìì—´ ë©ì–´ë¦¬(text)** ì˜€ë‹¤. vectorê°’ì€ `[ ~, ~, ~, ~, ~, ~, ]` ì´ëŸ° ì‹ì˜ íŒ¨í„´ì„ ê¸°ëŒ€í•˜ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ì˜¤ë¥˜ê°€ ë‚œ ê²ƒì´ë‹¤.
```ts
Â  @Column({
Â  Â  type: 'vector' as ColumnType,
Â  Â  length: 1024,
Â  Â  nullable: true,
Â  Â  transformer: vectorTransformer,
Â  })
Â  embedding: number[] | null;
```
```txt
ì‹¤ì œ ë„˜ì–´ì˜¨ ê°’ë“¤
6202","0.008274408","0.004519446","0.03435678","0.0051490203","0.02878055","-0.0300397","0.0067454414","-0.05216475","0.020865899","-0.030219577","-0.016009182","0.018797297","0.009623497","0.044250097","0.0055987164","-0.017628087","0.014120458","0.016368939","-0.04640864","0.0034851448","-0.026442131"}"
```

ê·¼ë° ì™œ ì˜¤ë¥˜ê°€ ë‚¬ì„ê¹Œâ“TypeORMì€ ê¸°ë³¸ì ìœ¼ë¡œ ë°°ì—´ì„ `{"0.1","0.2"}`ì²˜ëŸ¼ ì§ë ¬í™”í•œë‹¤ê³  í•œë‹¤.
ì•„í•˜.. JPAë‘ ë‹¤ë¥´ë„¤? 

ê·¼ë° ìš”ì¦˜ ìƒí™©ì´ ìƒí™©ì¸ì§€ë¼ ê¸‰í•˜ê²Œ ë„ˆë¬´ ë§ì€ ê¸°ìˆ ë“¤ì„ ë°°ìš°ë‹¤ë³´ë‹ˆ ì½”ë“œë¥¼ ì§œë©´ì„œë„ ì–¸ì–´ì˜ íŠ¹ì§•ì´ í—·ê°ˆë¦´ ì •ë„ë‹¤. Python, FastAPI, mongoDB, typeorm, NestJS, React, AWS ë“±...

---
### 2.2.  í•´ê²° 
```js
Â  async getPersonalizedPlaces(dto: GetPersonalizedPlacesByRegionReqDto) {
Â  Â  const { userId, region } = dto;
Â  Â  const embeddingValue: number[] = await this.profileService.getUserEmbeddingValueByUserId(userId);
Â  Â  const embeddingString = `[${embeddingValue.join(', ')}]`; // âœ… ë³€í™˜
Â  Â  const places: Place[] = await this.placeRepo
Â  Â  Â  .createQueryBuilder('p')
Â  Â  Â  .where('p.region = :region', { region })
Â  Â  Â  .orderBy('p.embedding <=> :embedding', 'ASC')
Â  Â  Â  .setParameters({ embedding: embeddingString }) // âœ… 
Â  Â  Â  .limit(50)
Â  Â  Â  .getMany();
  
Â  Â  return places.map((place) => GetPlacesResDto.from(place));
Â  }
```
vector í˜•ì‹ì— ë§ê²Œ ë³€í™˜í•˜ê³  ëŒ€ì…í•¨ìœ¼ë¡œì¨ ì •ìƒì ìœ¼ë¡œ ì¸ì‹í–ˆë‹¤.















,
	            ''
	        ) AS sido_normalized
	    FROM places
	)
	UPDATE places p
	SET region_group = CASE
	    WHEN n.sido_normalized = 'ì„œìš¸' THEN 'ì„œìš¸'::region_group_type
	    WHEN n.sido_normalized = 'ê²½ê¸°' THEN 'ê²½ê¸°ë„'::region_group_type
	    WHEN n.sido_normalized = 'ì¸ì²œ' THEN 'ì¸ì²œ'::region_group_type
	    WHEN n.sido_normalized = 'ê°•ì›' THEN 'ê°•ì›'::region_group_type
	    WHEN n.sido_normalized = 'ë¶€ì‚°' THEN 'ë¶€ì‚°'::region_group_type
	
	    WHEN n.sido_normalized IN ('ê²½ë‚¨', 'ê²½ë¶', 'ëŒ€êµ¬', 'ìš¸ì‚°')
	        THEN 'ê²½ìƒ'::region_group_type
	
	    WHEN n.sido_normalized IN ('ì „ë‚¨', 'ì „ë¶', 'ì„¸ì¢…')
	        THEN 'ì „ë¼ë„'::region_group_type
	
	    WHEN n.sido_normalized IN ('ì¶©ë‚¨', 'ì¶©ë¶', 'ëŒ€ì „')
	        THEN 'ì¶©ì²­'::region_group_type
	
	    WHEN n.sido_normalized = 'ì œì£¼'
	        THEN 'ì œì£¼ë„'::region_group_type
	
	    ELSE NULL
	END
	FROM normalized n
	WHERE p.id = n.id;
	```


---
### 1.4.  ì½”ë“œ ë³€ê²½

---
## 2.  ì„±í–¥ ì„ë² ë”© ê¸°ë°˜ ì¥ì†Œ ì¶”ì²œ 
---
### 2.1.  ë¬¸ì œ ğŸ’¢
{{CODE_BLOCK_3}}
- vectorëŠ” [ 1, 2, 3, 4, 5]

{{CODE_BLOCK_4}}

ì„ë² ë”© ê°’ì„ ë‹¤ë£¨ëŠ”ê±°ëŠ” ì²˜ìŒì´ë¼ í—·ê°ˆë ¸ë‹¤.
ë¶„ëª… Place entityì˜ embeddingê°’ì€ ì•„ë˜ì™€ ê°™ì€ë° ì‹¤ì œ ë„˜ì–´ì˜¨ vectorê°’ì€ ë¬¸ìì—´ì˜ { } ê´„í˜¸ê°€ ìˆëŠ” **ë¬¸ìì—´ ë©ì–´ë¦¬(text)** ì˜€ë‹¤. vectorê°’ì€ `[ ~, ~, ~, ~, ~, ~, ]` ì´ëŸ° ì‹ì˜ íŒ¨í„´ì„ ê¸°ëŒ€í•˜ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ì˜¤ë¥˜ê°€ ë‚œ ê²ƒì´ë‹¤.
{{CODE_BLOCK_5}}
{{CODE_BLOCK_6}}

ê·¼ë° ì™œ ì˜¤ë¥˜ê°€ ë‚¬ì„ê¹Œâ“TypeORMì€ ê¸°ë³¸ì ìœ¼ë¡œ ë°°ì—´ì„ `{"0.1","0.2"}`ì²˜ëŸ¼ ì§ë ¬í™”í•œë‹¤ê³  í•œë‹¤.
ì•„í•˜.. JPAë‘ ë‹¤ë¥´ë„¤? 

ê·¼ë° ìš”ì¦˜ ìƒí™©ì´ ìƒí™©ì¸ì§€ë¼ ê¸‰í•˜ê²Œ ë„ˆë¬´ ë§ì€ ê¸°ìˆ ë“¤ì„ ë°°ìš°ë‹¤ë³´ë‹ˆ ì½”ë“œë¥¼ ì§œë©´ì„œë„ ì–¸ì–´ì˜ íŠ¹ì§•ì´ í—·ê°ˆë¦´ ì •ë„ë‹¤. Python, FastAPI, mongoDB, typeorm, NestJS, React, AWS ë“±...

---
### 2.2.  í•´ê²° 
{{CODE_BLOCK_7}}
vector í˜•ì‹ì— ë§ê²Œ ë³€í™˜í•˜ê³  ëŒ€ì…í•¨ìœ¼ë¡œì¨ ì •ìƒì ìœ¼ë¡œ ì¸ì‹í–ˆë‹¤.















